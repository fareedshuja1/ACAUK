if(!String.prototype.format){String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return typeof a[c]!="undefined"?a[c]:b})}}window.TVproductions=window.TVproductions||{};(function(a,j,k){var o=null;var r=function(t,s){return j(".easy-photo-album-table tr["+t+'="'+s+'"]')};var n=function(){var s=[];j(".easy-photo-album-table tr td.column-image").each(function(u,w){$row=q(w);var t=parseInt($row.attr("data-epa-id"),10);var v={id:t,order:parseInt($row.attr("data-epa-order"),10),title:l(t),caption:b(t)};s.push(v)});j("#epa-albumdata").val(JSON.stringify(s))};var i=function(){p();d()};var p=function(){if(a.maxOrder<1){j(".easy-photo-album-table .row-actions .order_up, .easy-photo-album-table .row-actions .order_down").hide()}else{j(".easy-photo-album-table tr td.column-image").each(function(t,u){$row=q(u);order=parseInt($row.attr("data-epa-order"),10);if(order<=0){j(".row-actions .order_up",$row).hide();j(".row-actions .order_down",$row).show()}else{if(order>=a.maxOrder){j(".row-actions .order_down",$row).hide();j(".row-actions .order_up",$row).show();j(".row-actions .order_up",$row).html(j(".row-actions .order_up",$row).html().replace(" | ",""))}else{j(".row-actions .order_down, .row-actions .order_up",$row).show();if(j(".row-actions .order_up",$row).html().indexOf("|")===-1){j(".row-actions .order_up",$row).append(" | ")}}}})}var s;if(a.maxOrder==0){s=a.lang.photo}else{s=a.lang.photos}j("#easy-photo-album-images .displaying-num").html((a.maxOrder+1)+" "+s)};var g=function(t){var s=r("data-epa-id",t);if(s===k){return -1}else{return parseInt(s.attr("data-epa-order"),10)}};var m=function(s){var t=r("data-epa-order",s);if(t===k){return -1}else{return parseInt(t.attr("data-epa-id"),10)}};var c=function(t){var s=r("data-epa-id",t);return q('input[type=checkbox][value="'+t+'"]')};var q=function(s){return j(s).closest("tr")};var h=function(y,v,u){var t=m(u);var z=r("data-epa-id",t);var w=r("data-epa-id",v);if(j.isEmptyObject(z)||j.isEmptyObject(w)){return}var s=z.html();var x=w.html();if(s==k||x==k){console.error("Easy Photo Album: HTML Undefined Error");return}z.html(e(x,y,u));w.html(e(s,u,y))};var e=function(t,u,s){return t.replace('data-epa-order="'+u+'"','data-epa-order="'+s+'"')};var f=function(u,s){var t=r("data-epa-id",u);if(t===k){return}else{t.attr("data-epa-order",s)}};var d=function(){j(".order_up a.epa-move-up, .order_down a.epa-move-down, .delete a").unbind("click");setTimeout(function(){j(".order_up a.epa-move-up").click(function(s){if(s.target.tagName.toLowerCase()=="a"){a.moveUp(this)}s.preventDefault()});j(".order_down a.epa-move-down").click(function(s){if(s.target.tagName.toLowerCase()=="a"){a.moveDown(this)}s.preventDefault()});j(".delete a").click(function(s){if(s.target.tagName.toLowerCase()=="a"){a.deletePhoto(this)}s.preventDefault()});j('input[name="'+a.settingName+'[add_photo]"]').click(function(s){a.addPhoto(this);s.preventDefault()});j("easy-photo-album-table tbody tr").not(".alternate").css({"background-color":"#F9F9F9"})},50)};var l=function(s){return j("input#"+a.settingName+"-title-"+s).val()};var b=function(s){return j("textarea#"+a.settingName+"-caption-"+s).val()};a.moveUp=function(u){var v=parseInt(q(u).attr("data-epa-id"),10);var s=g(v);if(s<=0){return}var t=s-1;h(s,v,t);i()};a.moveDown=function(u){var v=parseInt(q(u).attr("data-epa-id"),10);var s=g(v);if(s>=a.maxOrder){return}var t=s+1;h(s,v,t);i()};a.addPhoto=function(s){if(!o){if(!wp.media){console.error("Easy Photo Album: Wordpress media files not included or loaded correctly. Uploads disabled.");return}o=wp.media({title:a.lang.mediatitle,button:{text:a.lang.mediabutton},library:{type:"image"},multiple:true,frame:"select"});o.on("select",function(){var t=o.state().get("selection");t.map(function(v){var x=v.toJSON();var u=a.maxOrder+=1;var w=_.template(a.rowtemplate,{alternate:(u%2===0?' class="alternate"':""),id:x.id,imgurl:(x.sizes.thumbnail==k?x.sizes.full.url:x.sizes.thumbnail.url),order:u,title:x.title,caption:x.caption});j(".easy-photo-album-table tr:last").after(w)});i()},this)}wp.media.model.settings.post.id=j("#post_ID").val();o.open()};a.deletePhoto=function(v){var x=parseInt(q(v).attr("data-epa-id"),10);if(x&&confirm(a.lang.deleteconfirm.format(l(x)))){var w=g(x);var t=q(v);t.remove();a.maxOrder-=1;for(var u=w;u<=a.maxOrder;u++){var s=m(u+1);f(s,u)}i()}};(function(){if(j(".easy-photo-album-table").length>0){if(a.settingName==k){console.info("EasyPhotoAlbum: settingName not set, use default");a.settingName="EasyPhotoAlbums"}if(a.maxOrder==k){console.info("EasyPhotoAlbum: maxOrder not set, calculate value");a.maxOrder=j("#the-list tr").length}i();j(".easy-photo-album-table tbody").sortable({axis:"y",handle:".column-image img",placeholder:"sortable-placeholder",forcePlaceholderSize:true,cursor:"move",opacity:0.6,update:function(t,u){jQuery(".easy-photo-album-table tbody tr").each(function(v,w){f(parseInt(q(w).attr("data-epa-id"),10),v)});j(".easy-photo-album-table tr:nth-child(odd)").addClass("alternate");j(".easy-photo-album-table tr:nth-child(even)").removeClass("alternate");i()}});j("#publish, #doaction, #doaction2, #post-preview, #save-post").click(n);var s=null;j(".epa-help").click(function(t){j(".epa-help-content").fadeOut("fast");if(s!=j(this).data("helpid")){j("#"+j(this).data("helpid")).fadeIn("fast").css("display","inline-block");s=j(this).data("helpid")}else{s=null}});j(document).click(function(t){if(s!=j(t.target).data("helpid")){j(".epa-help-content").fadeOut("fast");s=null}})}})()})(window.TVproductions.EasyPhotoAlbum=window.TVproductions.EasyPhotoAlbum||{},jQuery);